// Auto-generated from Edisyn JV-880 parameter tables.
// Source: tmp/edisyn/edisyn/synth/rolandjv880/*.java

export const JV880_MODEL_ID = 0x46;
export const JV880_DEVICE_ID_DEFAULT = 0x10;

export const PATCH_COMMON_PARAMS = [
  "patchname1",
  "patchname2",
  "patchname3",
  "patchname4",
  "patchname5",
  "patchname6",
  "patchname7",
  "patchname8",
  "patchname9",
  "patchname10",
  "patchname11",
  "patchname12",
  "velocityswitch",
  "reverbtype",
  "reverblevel",
  "reverbtime",
  "reverbfeedback",
  "chorustype",
  "choruslevel",
  "chorusdepth",
  "chorusrate",
  "chorusfeedback",
  "chorusoutput",
  "analogfeel",
  "patchlevel",
  "patchpanning",
  "patchpan",
  "bendrangedown",
  "bendrangeup",
  "keyassign",
  "sololegato",
  "portamentoswitch",
  "portamentomode",
  "portamentotype",
  "portamentotime"
];
export const TONE_PARAMS = [
  "wavegroup",
  "wavenumber",
  "-",
  "toneswitch",
  "fxmswitch",
  "fxmdepth",
  "velocityrangelower",
  "velocityrangeupper",
  "volumeswitch",
  "hold1switch",
  "modulationdestination1",
  "modulationsense1",
  "modulationdestination2",
  "modulationsense2",
  "modulationdestination3",
  "modulationsense3",
  "modulationdestination4",
  "modulationsense4",
  "aftertouchdestination1",
  "aftertouchsense1",
  "aftertouchdestination2",
  "aftertouchsense2",
  "aftertouchdestination3",
  "aftertouchsense3",
  "aftertouchdestination4",
  "aftertouchsense4",
  "expressiondestination1",
  "expressionsense1",
  "expressiondestination2",
  "expressionsense2",
  "expressiondestination3",
  "expressionsense3",
  "expressiondestination4",
  "expressionsense4",
  "lfo1form",
  "lfo1offset",
  "lfo1synchro",
  "lfo1rate",
  "lfo1delay",
  "-",
  "lfo1fadepolarity",
  "lfo1fadetime",
  "lfo1pitchdepth",
  "lfo1tvfdepth",
  "lfo1tvadepth",
  "lfo2form",
  "lfo2offset",
  "lfo2synchro",
  "lfo2rate",
  "lfo2delay",
  "-",
  "lfo2fadepolarity",
  "lfo2fadetime",
  "lfo2pitchdepth",
  "lfo2tvfdepth",
  "lfo2tvadepth",
  "pitchcoarse",
  "pitchfine",
  "randompitchdepth",
  "pitchkeyfollow",
  "penvvelocitylevelsense",
  "penvvelocityontimesense",
  "penvvelocityofftimesense",
  "penvtimekeyfollow",
  "penvdepth",
  "penvtime1",
  "penvlevel1",
  "penvtime2",
  "penvlevel2",
  "penvtime3",
  "penvlevel3",
  "penvtime4",
  "penvlevel4",
  "filtermode",
  "cutofffrequency",
  "resonance",
  "resonancemode",
  "cutoffkeyfollow",
  "tvfenvvelocitycurve",
  "tvfenvvelocitylevelsense",
  "tvfenvvelocityontimesense",
  "tvfenvvelocityofftimesense",
  "tvfenvtimekeyfollow",
  "tvfenvdepth",
  "tvfenvtime1",
  "tvfenvlevel1",
  "tvfenvtime2",
  "tvfenvlevel2",
  "tvfenvtime3",
  "tvfenvlevel3",
  "tvfenvtime4",
  "tvfenvlevel4",
  "level",
  "levelkeyfollow",
  "pan",
  "-",
  "panningkeyfollow",
  "tonedelaymode",
  "tonedelaytime",
  "-",
  "tvaenvvelocitycurve",
  "tvaenvvelocitylevelsense",
  "tvaenvvelocityontimesense",
  "tvaenvvelocityofftimesense",
  "tvaenvtimekeyfollow",
  "tvaenvtime1",
  "tvaenvlevel1",
  "tvaenvtime2",
  "tvaenvlevel2",
  "tvaenvtime3",
  "tvaenvlevel3",
  "tvaenvtime4",
  "drylevel",
  "reverbsendlevel",
  "chorussendlevel",
  "outputselect"
];
export const PERFORMANCE_COMMON_PARAMS = [
  "performancename1",
  "performancename2",
  "performancename3",
  "performancename4",
  "performancename5",
  "performancename6",
  "performancename7",
  "performancename8",
  "performancename9",
  "performancename10",
  "performancename11",
  "performancename12",
  "keymode",
  "reverbtype",
  "reverblevel",
  "reverbtime",
  "reverbfeedback",
  "chorustype",
  "choruslevel",
  "chorusdepth",
  "chorusrate",
  "chorusfeedback",
  "chorusoutput",
  "voicereserve1",
  "voicereserve2",
  "voicereserve3",
  "voicereserve4",
  "voicereserve5",
  "voicereserve6",
  "voicereserve7",
  "voicereserve8"
];
export const PART_PARAMS = [
  "transmitswitch",
  "transmitchannel",
  "transmitprogramchange",
  "-",
  "transmitvolume",
  "-",
  "transmitpan",
  "-",
  "transmitkeyrangelower",
  "transmitkeyrangeupper",
  "transmitkeytranspose",
  "transmitvelocitysense",
  "transmitvelocitymax",
  "transmitvelocitycurve",
  "internalswitch",
  "internalkeyrangelower",
  "internalkeyrangeupper",
  "internalkeytranspose",
  "internalvelocitysense",
  "internalvelocitymax",
  "internalvelocitycurve",
  "receiveswitch",
  "receivechannel",
  "patchnumber",
  "-",
  "partlevel",
  "partpan",
  "partcoarsetune",
  "partfinetune",
  "reverbswitch",
  "chorusswitch",
  "receiveprogramchange",
  "receivevolume",
  "receivehold1",
  "outputselect"
];
export const DRUM_PARAMS = [
  "wavegroup",
  "wavenumber",
  "-",
  "toneswitch",
  "coarsetune",
  "mutegroup",
  "envelopemode",
  "pitchfine",
  "randompitchdepth",
  "pitchbendrange",
  "penvvelocitylevelsense",
  "penvvelocitytimesense",
  "penvdepth",
  "penvtime1",
  "penvlevel1",
  "penvtime2",
  "penvlevel2",
  "penvtime3",
  "penvlevel3",
  "penvtime4",
  "penvlevel4",
  "filtermode",
  "cutoff",
  "resonance",
  "resonancemode",
  "tvfenvvelocitylevelsense",
  "tvfenvvelocitytimesense",
  "tvfenvdepth",
  "tvfenvtime1",
  "tvfenvlevel1",
  "tvfenvtime2",
  "tvfenvlevel2",
  "tvfenvtime3",
  "tvfenvlevel3",
  "tvfenvtime4",
  "tvfenvlevel4",
  "level",
  "pan",
  "-",
  "tvaenvvelocitylevelsense",
  "tvaenvvelocitytimesense",
  "tvaenvtime1",
  "tvaenvlevel1",
  "tvaenvtime2",
  "tvaenvlevel2",
  "tvaenvtime3",
  "tvaenvlevel3",
  "tvaenvtime4",
  "drylevel",
  "reverbsendlevel",
  "chorussendlevel",
  "outputselect"
];

const patchCommonIndex = new Map(PATCH_COMMON_PARAMS.map((key, idx) => [key, idx]));
const toneIndex = new Map(TONE_PARAMS.map((key, idx) => [key, idx]));
const performanceCommonIndex = new Map(PERFORMANCE_COMMON_PARAMS.map((key, idx) => [key, idx]));
const partIndex = new Map(PART_PARAMS.map((key, idx) => [key, idx]));
const drumIndex = new Map(DRUM_PARAMS.map((key, idx) => [key, idx]));

const twoByteParams = new Set([
  "lfo1delay",
  "lfo2delay",
  "pan",
  "patchnumber",
  "tonedelaytime",
  "transmitpan",
  "transmitprogramchange",
  "transmitvolume",
  "wavenumber"
]);

export function clampValue(value, min, max) {
  if (value < min) return min;
  if (value > max) return max;
  return value;
}

export function encodeValue(key, value) {
  const v = clampValue(value, 0, 2031);
  if (twoByteParams.has(key)) {
    return [(v >> 4) & 0x7f, v & 0x0f];
  }
  return [v & 0x7f];
}

export function checksum(bytes) {
  let sum = 0;
  for (const b of bytes) sum += b;
  sum &= 0x7f;
  const chk = 0x80 - sum;
  return chk === 0x80 ? 0 : chk;
}

export function buildDT1(address, data, deviceId = JV880_DEVICE_ID_DEFAULT) {
  const body = [...address, ...data];
  const chk = checksum(body);
  return [0xf0, 0x41, deviceId, JV880_MODEL_ID, 0x12, ...body, chk, 0xf7];
}

export function buildSystemMode(mode, deviceId = JV880_DEVICE_ID_DEFAULT) {
  const value = mode === "performance" ? 0x00 : 0x01;
  return buildDT1([0x00, 0x00, 0x00, 0x00], [value], deviceId);
}

export function buildPatchCommonParam(key, value, deviceId = JV880_DEVICE_ID_DEFAULT) {
  const idx = patchCommonIndex.get(key);
  if (idx === undefined) return null;
  const data = encodeValue(key, value);
  return buildDT1([0x00, 0x08, 0x20, idx], data, deviceId);
}

export function buildToneParam(toneIndexValue, key, value, deviceId = JV880_DEVICE_ID_DEFAULT) {
  const idx = toneIndex.get(key);
  if (idx === undefined) return null;
  const data = encodeValue(key, value);
  const cc = 0x20 + 0x08 + toneIndexValue;
  return buildDT1([0x00, 0x08, cc, idx], data, deviceId);
}

export function buildPerformanceCommonParam(key, value, deviceId = JV880_DEVICE_ID_DEFAULT) {
  const idx = performanceCommonIndex.get(key);
  if (idx === undefined) return null;
  const data = encodeValue(key, value);
  return buildDT1([0x00, 0x00, 0x10, idx], data, deviceId);
}

export function buildPartParam(partIndexValue, key, value, deviceId = JV880_DEVICE_ID_DEFAULT) {
  const idx = partIndex.get(key);
  if (idx === undefined) return null;
  const data = encodeValue(key, value);
  const cc = 0x10 + 0x08 + partIndexValue;
  return buildDT1([0x00, 0x00, cc, idx], data, deviceId);
}

export function buildDrumParam(note, key, value, deviceId = JV880_DEVICE_ID_DEFAULT) {
  const idx = drumIndex.get(key);
  if (idx === undefined) return null;
  const data = encodeValue(key, value);
  const cc = clampValue(note, 36, 96) + 0x40;
  return buildDT1([0x00, 0x07, cc, idx], data, deviceId);
}
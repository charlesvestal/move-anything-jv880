# Mini-JV Move UI Design

## Purpose
Implement a full Mini-JV front-panel UI on Ableton Move with three states (Play, Edit, Utility), a persistent favorites system, and SysEx-capable UI -> DSP control. The module remains a sound generator only (no sequencer/clip behavior).

## Architecture Summary
- DSP remains the Mini-JV emulator and authoritative sound engine.
- UI is a state machine (Play/Edit/Utility) with a fixed 4-line display stack and contextual help.
- UI sends control to DSP via:
  - `host_module_set_param` for fast controls (patch change, octave, bank jump).
  - `host_module_send_midi` for full JV control (variable-length SysEx).
- DSP exposes read-only state to UI via `host_module_get_param` (LCD lines, patch name, bank name, etc.).

## Display Layout
- Always-visible 4-line stack (8px font):
  1) HUD line 1 (activity: encoder touch, MIDI input, program changes)
  2) HUD line 2 (context: mode, patch/perf name, part/tone, RX/Thru)
  3) JV LCD line 1 (24 chars)
  4) JV LCD line 2 (24 chars)
- Contextual help line replaces line 4 for 2 seconds after a state change, then returns to LCD line 2.
- Help line never persists beyond 2 seconds.

## State Machine
- Play (default): performance controls and patch/part selection.
- Edit (MENU): JV LCD pages, full parameter access, D-pad cursor, jog value.
- Utility (SHIFT+MENU): init/copy/naming, MIDI/system configuration.
- BACK exits one level; hold BACK returns to Play.
- Destructive actions use HUD confirmation: MENU confirm, BACK cancel.

## Control Mapping Matrix (State x Control)

### Global
| Control | Play | Edit | Utility |
| --- | --- | --- | --- |
| MENU | Enter Edit | N/A | N/A |
| SHIFT + MENU | Enter Utility | N/A | N/A |
| BACK | Exit view/confirm cancel | Exit level | Exit level |
| Hold BACK | Return to Play | Return to Play | Return to Play |
| SHIFT + Jog | Fine / accelerated adjust | Fine adjust | Fine adjust |

### D-pad / Jog
| Control | Play | Edit | Utility |
| --- | --- | --- | --- |
| Left / Right | Patch/Part selection | Cursor left/right | Cursor left/right |
| Up / Down | Octave - / + | Cursor up/down | Cursor up/down |
| Jog | Patch/Part selection | Value change | Value change |

### Encoders (8)
| Control | Play | Edit | Utility |
| --- | --- | --- | --- |
| Touch | HUD info only | HUD info only | HUD info only |
| Turn | Macro params (cutoff, reso, attack, release, LFO rate/depth, FX send, level) | Page parameters 1-8 | Page parameters 1-8 |

### Track Buttons (4)
| Control | Patch Mode | Performance Mode |
| --- | --- | --- |
| Track 1-4 | Select Tone 1-4 | Select Part within bank |
| SHIFT + Track | Tone mute/enable | Part mute/solo |

### Step Buttons (16)
- Play shortcuts:
  1 Patch Mode, 2 Performance Mode, 3 Rhythm Focus, 4 FX, 5 Favorites, 6 Part Bank Toggle,
  7 Octave -, 8 Octave +, 9 Transpose -, 10 Transpose +, 11 Velocity Mode, 12 MIDI Monitor,
  13 Output Assign View, 14 Local Control Toggle, 15 SysEx RX/Thru Toggle, 16 Utility Shortcut.
- Edit tabs:
  1 HOME, 2 COMMON, 3 TONE/WG, 4 PITCH, 5 TVF, 6 TVA, 7 LFO, 8 OUT/FX,
  9 MOD, 10 CTRL, 11 STRUCT, 12 MIX, 13 PART, 14 RHYTHM, 15 FX, 16 UTIL.

### Pads (8x4)
- Always audition and never repurposed for editing.
- Velocity -> TVA; aftertouch routed per modulation config.
- Rhythm edit focus: last note wins (internal or external); D-pad/jog can override.

### Transport & Utility Buttons
- PLAY: audition latch.
- REC (seq): MIDI monitor toggle.
- LOOP: sustain latch.
- CAPTURE: compare (edited vs stored).
- REC (audio): panic / all notes off.
- SHIFT + REC (audio): reset controllers.
- MUTE: tone/part mute.
- COPY: copy tone->tone or part->part.
- DELETE: init tone / clear part (confirm).
- UNDO: undo last edit; SHIFT + UNDO: redo.

## Favorites
- Stored in `favorites.json` in the module folder.
- Step 5 enters a Favorites list view in Play; MENU confirms selection.
- SHIFT + step 5 toggles current patch/part favorite status.
- Fail-safe: on read failure, start empty; on write failure show HUD error and keep in-memory state.

## SysEx Support (Host + DSP)
- Extend `host_module_send_midi` to accept variable-length arrays (>=1 bytes) and pass full `len` to `mm_on_midi`.
- DSP MIDI queue length increased (e.g., 256 bytes); long messages clipped or dropped with a counter for debug.
- UI uses SysEx for Edit/Utility parameter changes and page navigation.
- External MIDI SysEx continues to pass through unchanged.

## Error Handling
- SysEx drop or queue overflow: show transient HUD warning (e.g., "SYSX DROP").
- Destructive operations always require HUD confirmation.
- Favorites write failure surfaced in HUD.

## Testing
- Manual:
  - Play state patch/part selection via left/right/jog.
  - Edit state cursor/value and page switching with steps.
  - Favorites add/remove and persistence across restart.
  - Contextual help line appears for 2 seconds after state change.
  - SysEx round-trip by changing a JV page parameter and observing LCD update.

## Open Items
- Confirm exact SysEx messages or front-panel emulation needed for page navigation.
- Confirm Move hardware button mapping for step/track/transport if any host-level remaps exist.
